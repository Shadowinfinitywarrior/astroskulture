<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astros Kulture</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <img src="logo.png" alt="Astros Kulture">
        </div>
        <div class="mobile-controls">
            <div class="mobile-search">
                <input type="text" placeholder="Search" id="mobile-search">
            </div>
            <a href="cart.html" class="mobile-cart">Cart</a>
            <div class="menu-toggle">â˜°</div>
        </div>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li class="dropdown-parent">
                <a href="#">Products</a>
                <ul class="dropdown">
                    <li><a href="shop.html?category=oversized">Oversized T-shirts</a></li>
                    <li><a href="shop.html?category=normal">Normal T-shirts</a></li>
                    <li><a href="shop.html?category=shirts">Shirts</a></li>
                    <li><a href="shop.html?category=pants">Men Cotton Pants</a></li>
                </ul>
            </li>
            <li class="dropdown-parent">
                <a href="#">Account</a>
                <ul class="dropdown" id="account-menu">
                    <li><a href="login.html" class="login-link">Login</a></li>
                    <li><a href="register.html" class="login-link">Register</a></li>
                    <li><a href="account.html" class="dashboard-link">Dashboard</a></li>
                </ul>
            </li>
            <li class="desktop-search">
                <input type="text" placeholder="Search" id="search" onkeyup="searchProducts()">
            </li>
            <li class="desktop-cart">
                <a href="cart.html">Cart</a>
            </li>
        </ul>
    </nav>

    <!-- Promotional Banner -->
    <section class="promo-banner">
        <div class="banner-content">
            <h1>Min 55% Off</h1>
            <p>Discover Amazing Deals</p>
        </div>
    </section>

    <section class="hero fade-in">
        <h1>Welcome to Astros Kulture</h1>
        <p>Explore our exclusive collection of premium clothing</p>
        <a href="shop.html" class="btn">Shop Now</a>
    </section>

    <!-- Featured Products Section -->
    <section class="product-row">
        <h2>Featured Products</h2>
        <div id="featured-products" class="products-grid">
            <!-- Featured products will be loaded here -->
        </div>
        <a href="shop.html" class="view-all">View All Products</a>
    </section>

    <!-- New Arrivals Section -->
    <section class="product-row">
        <h2>New Arrivals</h2>
        <div id="new-arrivals" class="products-grid">
            <!-- New arrivals will be loaded here -->
        </div>
        <a href="shop.html?sort=newest" class="view-all">View All New Arrivals</a>
    </section>

    <!-- Best Sellers Section -->
    <section class="product-row">
        <h2>Best Sellers</h2>
        <div id="best-sellers" class="products-grid">
            <!-- Best sellers will be loaded here -->
        </div>
        <a href="shop.html?sort=popular" class="view-all">View All Best Sellers</a>
    </section>

    <!-- Recently Viewed Section -->
    <section class="product-row">
        <h2>Recently Viewed</h2>
        <div id="recently-viewed" class="products-grid">
            <!-- Recently viewed products will be loaded here -->
        </div>
    </section>

    <!-- Categories Section -->
    <section class="product-row">
        <h2>Shop by Category</h2>
        <div class="categories-grid">
            <a href="shop.html?category=oversized" class="category-card">
                <div class="category-icon">ðŸ‘•</div>
                <h3>Oversized T-shirts</h3>
                <p>Comfortable and stylish oversized fits</p>
            </a>
            <a href="shop.html?category=normal" class="category-card">
                <div class="category-icon">ðŸŽ½</div>
                <h3>Normal T-shirts</h3>
                <p>Classic fits for everyday wear</p>
            </a>
            <a href="shop.html?category=shirts" class="category-card">
                <div class="category-icon">ðŸ‘”</div>
                <h3>Shirts</h3>
                <p>Premium shirts for all occasions</p>
            </a>
            <a href="shop.html?category=pants" class="category-card">
                <div class="category-icon">ðŸ‘–</div>
                <h3>Men Cotton Pants</h3>
                <p>Comfortable cotton pants</p>
            </a>
        </div>
    </section>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Contact Information</h3>
                <p><strong>MAIL SUPPORT:</strong> help.astroskulture@gmail.com</p>
                <p><strong>WHATSAPP:</strong> 7871658830</p>
                <p><strong>INSTAGRAM:</strong> <a href="https://www.instagram.com/astroskulture.in" target="_blank">@astroskulture.in</a></p>
                <p><strong>ADDRESS:</strong> 21c/144B North Kennedy St, MKP Nagar, Palaiyamkottai - Tirunelveli 627002</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <a href="index.html">Home</a>
                <a href="shop.html">Shop</a>
                <a href="cart.html">Cart</a>
                <a href="account.html">Account</a>
            </div>
            <div class="footer-section">
                <h3>Policies</h3>
                <a href="#">Terms & Conditions</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Return Policy</a>
                <a href="#">Shipping Policy</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Astros Kulture. All rights reserved.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        updateAccountMenu();
        
        async function loadHomepageContent() {
            try {
                // Load featured products
                await loadFeaturedProducts();
                
                // Load new arrivals
                await loadNewArrivals();
                
                // Load best sellers
                await loadBestSellers();
                
                // Load recently viewed
                await loadRecentlyViewed();
                
            } catch (error) {
                console.error('Error loading homepage content:', error);
                showErrorStates();
            }
        }

        async function loadFeaturedProducts() {
            try {
                const response = await fetch('/api/products?featured=true&limit=8');
                const data = await response.json();
                
                if (data.success && data.products.length > 0) {
                    displayProducts(data.products, 'featured-products');
                } else {
                    document.getElementById('featured-products').innerHTML = `
                        <div class="no-products">
                            <p>No featured products available</p>
                            <a href="shop.html" class="btn">Browse Products</a>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading featured products:', error);
                document.getElementById('featured-products').innerHTML = `
                    <div class="error-state">
                        <p>Error loading featured products</p>
                        <button class="btn" onclick="loadFeaturedProducts()">Retry</button>
                    </div>
                `;
            }
        }

        async function loadNewArrivals() {
            try {
                const response = await fetch('/api/products?sort=newest&limit=8');
                const data = await response.json();
                
                if (data.success && data.products.length > 0) {
                    displayProducts(data.products, 'new-arrivals');
                } else {
                    document.getElementById('new-arrivals').innerHTML = `
                        <div class="no-products">
                            <p>No new arrivals available</p>
                            <a href="shop.html" class="btn">Browse Products</a>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading new arrivals:', error);
                document.getElementById('new-arrivals').innerHTML = `
                    <div class="error-state">
                        <p>Error loading new arrivals</p>
                        <button class="btn" onclick="loadNewArrivals()">Retry</button>
                    </div>
                `;
            }
        }

        async function loadBestSellers() {
            try {
                const response = await fetch('/api/products?sort=popular&limit=8');
                const data = await response.json();
                
                if (data.success && data.products.length > 0) {
                    displayProducts(data.products, 'best-sellers');
                } else {
                    document.getElementById('best-sellers').innerHTML = `
                        <div class="no-products">
                            <p>No best sellers available</p>
                            <a href="shop.html" class="btn">Browse Products</a>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading best sellers:', error);
                document.getElementById('best-sellers').innerHTML = `
                    <div class="error-state">
                        <p>Error loading best sellers</p>
                        <button class="btn" onclick="loadBestSellers()">Retry</button>
                    </div>
                `;
            }
        }

        async function loadRecentlyViewed() {
            const recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
            
            if (recentlyViewed.length === 0) {
                document.getElementById('recently-viewed').innerHTML = `
                    <div class="no-products">
                        <p>No recently viewed items</p>
                        <p>Start browsing to see your recently viewed products here</p>
                    </div>
                `;
                return;
            }

            try {
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ids: recentlyViewed.slice(0, 8) })
                });
                const data = await response.json();
                
                if (data.success && data.products.length > 0) {
                    displayProducts(data.products, 'recently-viewed');
                } else {
                    document.getElementById('recently-viewed').innerHTML = `
                        <div class="no-products">
                            <p>No recently viewed items available</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading recently viewed:', error);
                document.getElementById('recently-viewed').innerHTML = `
                    <div class="error-state">
                        <p>Error loading recently viewed</p>
                        <button class="btn" onclick="loadRecentlyViewed()">Retry</button>
                    </div>
                `;
            }
        }

        function displayProducts(products, containerId) {
            const container = document.getElementById(containerId);
            
            container.innerHTML = products.map(product => {
                const discount = product.originalPrice && product.originalPrice > product.price ? 
                    Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100) : 0;
                
                const stockStatus = getStockStatus(product.stock || 0);
                
                return `
                    <div class="product-card">
                        <div class="product-image">
                            <img src="${product.images && product.images[0] ? product.images[0] : 'logo.png'}" 
                                 alt="${product.name}" 
                                 onerror="this.src='logo.png'"
                                 onclick="window.location.href='product.html?id=${product._id}'"
                                 style="cursor: pointer;">
                            ${discount > 0 ? `<div class="discount-badge">${discount}% OFF</div>` : ''}
                            <div class="stock-badge ${stockStatus}">${stockStatus.replace('-', ' ')}</div>
                            ${product.featured ? `<div class="featured-badge">Featured</div>` : ''}
                        </div>
                        <div class="product-info">
                            <h3>${product.name}</h3>
                            ${product.brand ? `<p class="brand">${product.brand}</p>` : ''}
                            <div class="rating">
                                <span class="stars">${'â˜…'.repeat(Math.floor(product.rating || 4))}${'â˜†'.repeat(5-Math.floor(product.rating || 4))}</span>
                                <span class="review-count">(${product.reviewCount || 0})</span>
                            </div>
                            <div class="price">
                                <span class="current-price">â‚¹${(product.price || 0).toFixed(2)}</span>
                                ${product.originalPrice && product.originalPrice > product.price ? 
                                    `<span class="original-price">â‚¹${product.originalPrice.toFixed(2)}</span>` : ''
                                }
                                ${discount > 0 ? `<span class="discount-tag">Save ${discount}%</span>` : ''}
                            </div>
                            <div class="product-actions">
                                <button class="btn buy-now-btn" onclick="buyNow('${product._id}')">Buy Now</button>
                                <button class="btn cart-btn" onclick="addToCart('${product._id}')">Add to Cart</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getStockStatus(stock) {
            if (stock > 10) return 'in-stock';
            if (stock > 0) return 'low-stock';
            return 'out-of-stock';
        }

        function buyNow(productId) {
            // Add to cart and redirect to checkout/cart page
            addToCart(productId);
            window.location.href = 'cart.html';
        }

        function showErrorStates() {
            const sections = ['featured-products', 'new-arrivals', 'best-sellers', 'recently-viewed'];
            
            sections.forEach(section => {
                const container = document.getElementById(section);
                if (container && container.innerHTML === '') {
                    container.innerHTML = `
                        <div class="error-state">
                            <p>Unable to load products</p>
                            <button class="btn" onclick="loadHomepageContent()">Retry</button>
                        </div>
                    `;
                }
            });
        }

        async function searchProducts() {
            const searchTerm = document.getElementById('search').value.toLowerCase();
            const mobileSearchTerm = document.getElementById('mobile-search').value.toLowerCase();
            const term = searchTerm || mobileSearchTerm;
            
            if (term.length < 3) {
                loadHomepageContent();
                return;
            }
            
            try {
                const response = await fetch(`/api/products/search?query=${encodeURIComponent(term)}`);
                const data = await response.json();
                
                if (data.success) {
                    // Clear all sections and show search results in featured section
                    document.getElementById('featured-products').innerHTML = '';
                    document.getElementById('new-arrivals').innerHTML = '';
                    document.getElementById('best-sellers').innerHTML = '';
                    document.getElementById('recently-viewed').innerHTML = '';
                    
                    document.querySelector('.product-row h2').textContent = `Search Results for "${term}"`;
                    
                    if (data.products.length > 0) {
                        displayProducts(data.products.slice(0, 8), 'featured-products');
                    } else {
                        document.getElementById('featured-products').innerHTML = `
                            <div class="no-products">
                                <p>No products found for "${term}"</p>
                                <a href="shop.html" class="btn">Browse All Products</a>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error('Error searching products:', error);
                document.getElementById('featured-products').innerHTML = `
                    <div class="error-state">
                        <p>Error searching products</p>
                        <button class="btn" onclick="searchProducts()">Retry</button>
                    </div>
                `;
            }
        }

        function addToRecentlyViewed(productId) {
            let recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
            recentlyViewed = recentlyViewed.filter(id => id !== productId);
            recentlyViewed.unshift(productId);
            recentlyViewed = recentlyViewed.slice(0, 10);
            localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
        }

        // Mobile search functionality
        document.getElementById('mobile-search').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                searchProducts();
            }
        });

        // Initialize homepage
        document.addEventListener('DOMContentLoaded', function() {
            loadHomepageContent();
        });
    </script>

    <style>
        /* Additional styles for the updated homepage */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-lg);
            margin-top: var(--space-lg);
        }

        .category-card {
            background: var(--bg-white);
            padding: var(--space-xl);
            border-radius: var(--radius-xl);
            text-align: center;
            text-decoration: none;
            color: var(--text-dark);
            transition: var(--transition);
            box-shadow: var(--shadow-md);
            border: 2px solid transparent;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
            color: var(--text-dark);
        }

        .category-icon {
            font-size: 3rem;
            margin-bottom: var(--space-md);
        }

        .category-card h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4rem;
            margin-bottom: var(--space-sm);
            font-weight: 600;
        }

        .category-card p {
            color: var(--text-light);
            line-height: 1.5;
        }

        .no-products, .error-state {
            text-align: center;
            padding: var(--space-xl);
            background: var(--bg-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            grid-column: 1 / -1;
        }

        .no-products p, .error-state p {
            margin-bottom: var(--space-md);
            color: var(--text-light);
        }

        /* Updated button styles */
        .buy-now-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            flex: 1;
            margin-right: var(--space-sm);
        }

        .buy-now-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .cart-btn {
            background: var(--secondary-color);
            color: var(--text-dark);
            border: 2px solid var(--border-color);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            flex: 1;
        }

        .cart-btn:hover {
            background: var(--border-color);
            transform: translateY(-2px);
        }

        .product-actions {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-md);
        }

        @media (max-width: 768px) {
            .categories-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: var(--space-md);
            }
            
            .category-card {
                padding: var(--space-lg);
            }
            
            .category-icon {
                font-size: 2.5rem;
            }

            .product-actions {
                flex-direction: column;
            }

            .buy-now-btn, .cart-btn {
                margin-right: 0;
                margin-bottom: var(--space-sm);
            }
        }
    </style>
</body>
</html>
