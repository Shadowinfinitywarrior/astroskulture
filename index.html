<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astros Kulture</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <img src="logo.png" alt="Astros Kulture">
        </div>
        <div class="mobile-controls">
            <div class="mobile-search">
                <input type="text" placeholder="Search" id="mobile-search">
            </div>
            <a href="cart.html" class="mobile-cart">Cart</a>
            <div class="menu-toggle">☰</div>
        </div>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li class="dropdown-parent">
                <a href="#">Products</a>
                <ul class="dropdown">
                    <li><a href="shop.html?category=oversized">Oversized T-shirts</a></li>
                    <li><a href="shop.html?category=normal">Normal T-shirts</a></li>
                    <li><a href="shop.html?category=shirts">Shirts</a></li>
                    <li><a href="shop.html?category=pants">Men Cotton Pants</a></li>
                </ul>
            </li>
            <li class="dropdown-parent">
                <a href="#">Account</a>
                <ul class="dropdown" id="account-menu">
                    <li><a href="login.html" class="login-link">Login</a></li>
                    <li><a href="register.html" class="login-link">Register</a></li>
                    <li><a href="account.html" class="dashboard-link">Dashboard</a></li>
                </ul>
            </li>
            <li class="desktop-search">
                <input type="text" placeholder="Search" id="search" onkeyup="searchProducts()">
            </li>
            <li class="desktop-cart">
                <a href="cart.html">Cart</a>
            </li>
        </ul>
    </nav>

    <!-- Promotional Banner -->
    <section class="promo-banner">
        <div class="banner-content">
            <h1>Min 55% Off</h1>
            <p>3979 Products</p>
        </div>
    </section>

    <section class="hero fade-in">
        <h1>Welcome to Astros Kulture</h1>
        <p>Explore our exclusive collection of T-shirts</p>
        <a href="shop.html" class="btn">Shop Now</a>
    </section>

    <!-- Featured Products Section -->
    <section class="product-row">
        <h2>Featured Products</h2>
        <div class="products-grid">
            <div class="product-card">
                <div class="product-image">
                    <img src="logo.png" alt="Smart High-Waist Trousers">
                </div>
                <div class="product-info">
                    <h3>ASOS DESIGN Smart High-Waist Straight Leg Pleated Trousers</h3>
                    <div class="rating">4.5 ★ | 2</div>
                    <div class="price">
                        <span class="current-price">¥1,762</span>
                        <span class="original-price">¥4,213</span>
                        <span class="discount">58% off</span>
                    </div>
                </div>
            </div>
            
            <div class="product-card">
                <div class="product-image">
                    <img src="logo.png" alt="Slim Fit Oxford Shirt">
                </div>
                <div class="product-info">
                    <h3>ASOS DESIGN Men Slim Fit Oxford Shirt</h3>
                    <div class="rating">3.7 ★ | 9</div>
                    <div class="price">
                        <span class="current-price">¥1,101</span>
                        <span class="original-price">¥2,342</span>
                        <span class="discount">53% off</span>
                    </div>
                </div>
            </div>

            <div class="product-card">
                <div class="product-image">
                    <img src="logo.png" alt="Button-Through Shirt">
                </div>
                <div class="product-info">
                    <h3>ASOS DESIGN Men Button-Through Regular Fit Shirt</h3>
                    <div class="rating">4.5 ★ | 6</div>
                    <div class="price">
                        <span class="current-price">¥1,321</span>
                        <span class="original-price">¥3,159</span>
                        <span class="discount">58% off</span>
                    </div>
                </div>
            </div>

            <div class="product-card">
                <div class="product-image">
                    <img src="logo.png" alt="Oversized Crew-Neck T-Shirt">
                </div>
                <div class="product-info">
                    <h3>ASOS DESIGN Men Oversized Crew-Neck T-Shirt</h3>
                    <div class="rating">5 ★ | 2</div>
                    <div class="price">
                        <span class="current-price">¥879</span>
                        <span class="original-price">¥1,874</span>
                        <span class="discount">53% off</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Spaceout Collection -->
    <section class="product-row">
        <h2>SPACEOUT Collection</h2>
        <div class="products-grid">
            <div class="product-card">
                <div class="product-image">
                    <img src="logo.png" alt="Music Oversized T-Shirt">
                </div>
                <div class="product-info">
                    <h3>MUSIC OVERSIZED HEAVYWEIGHT T-SHIRT</h3>
                    <p class="brand">SPACEOUT</p>
                    <div class="price">
                        <span class="current-price">¥999.00</span>
                        <span class="original-price">¥1,399.00</span>
                    </div>
                    <button class="btn choose-options">Choose options</button>
                    <span class="sale-badge">Sale</span>
                </div>
            </div>

            <div class="product-card">
                <div class="product-image">
                    <img src="logo.png" alt="Memories Black T-Shirt">
                </div>
                <div class="product-info">
                    <h3>MEMORIES BLACK OVERSIZED HEAVYWEIGHT T-SHIRT</h3>
                    <p class="brand">SPACEOUT</p>
                    <div class="price">
                        <span class="current-price">¥999.00</span>
                        <span class="original-price">¥1,399.00</span>
                    </div>
                    <button class="btn choose-options">Choose options</button>
                    <span class="sale-badge">Sale</span>
                </div>
            </div>

            <div class="product-card">
                <div class="product-image">
                    <img src="logo.png" alt="Manifest Beige T-Shirt">
                </div>
                <div class="product-info">
                    <h3>MANIFEST BEIGE OVERSIZED HEAVYWEIGHT T-SHIRT</h3>
                    <p class="brand">SPACEOUT</p>
                    <div class="price">
                        <span class="current-price">¥999.00</span>
                        <span class="original-price">¥1,399.00</span>
                    </div>
                    <button class="btn choose-options">Choose options</button>
                    <span class="sale-badge">Sale</span>
                </div>
            </div>
        </div>
    </section>

    <section class="product-row">
        <h2 id="row1-title">Featured Oversized</h2>
        <div id="row1-products" class="products-grid"></div>
        <a href="category.html?row=row1" class="view-all">View All</a>
    </section>

    <section class="product-row">
        <h2 id="row2-title">New Arrivals</h2>
        <div id="row2-products" class="products-grid"></div>
        <a href="category.html?row=row2" class="view-all">View All</a>
    </section>

    <section class="product-row">
        <h2>Recently Viewed</h2>
        <div id="recently-viewed" class="products-grid"></div>
    </section>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Contact Information</h3>
                <p><strong>MAIL SUPPORT:</strong> help.astroskulture@gmail.com</p>
                <p><strong>WHATSAPP:</strong> 7871658830</p>
                <p><strong>INSTAGRAM:</strong> <a href="https://www.instagram.com/astroskulture.in" target="_blank">@astroskulture.in</a></p>
                <p><strong>ADDRESS:</strong> 21c/144B North Kennedy St, MKP Nagar, Palaiyamkottai - Tirunelveli 627002</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <a href="index.html">Home</a>
                <a href="shop.html">Shop</a>
                <a href="cart.html">Cart</a>
                <a href="account.html">Account</a>
            </div>
            <div class="footer-section">
                <h3>Policies</h3>
                <a href="#">Terms & Conditions</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Return Policy</a>
                <a href="#">Shipping Policy</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Astros Kulture. All rights reserved.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        updateAccountMenu();
        async function loadProductRows() {
            try {
                const response = await fetch('/api/home');
                const data = await response.json();
                if (data.success) {
                    document.getElementById('row1-title').textContent = data.row1.title;
                    document.getElementById('row1-products').innerHTML = data.row1.products.map(product => `
                        <div class="product">
                            <img src="${product.images[0] || 'logo.png'}" alt="${product.name}">
                            <h3>${product.name}</h3>
                            <p>₹${product.price.toFixed(2)}</p>
                            <a href="product.html?id=${product._id}" class="btn" onclick="addToRecentlyViewed('${product._id}')">View</a>
                            <button class="btn" onclick="addToCart('${product._id}')">Add to Cart</button>
                        </div>
                    `).join('');

                    document.getElementById('row2-title').textContent = data.row2.title;
                    document.getElementById('row2-products').innerHTML = data.row2.products.map(product => `
                        <div class="product">
                            <img src="${product.images[0] || 'logo.png'}" alt="${product.name}">
                            <h3>${product.name}</h3>
                            <p>₹${product.price.toFixed(2)}</p>
                            <a href="product.html?id=${product._id}" class="btn" onclick="addToRecentlyViewed('${product._id}')">View</a>
                            <button class="btn" onclick="addToCart('${product._id}')">Add to Cart</button>
                        </div>
                    `).join('');

                    const recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]').slice(0, 4);
                    if (recentlyViewed.length) {
                        const recentResponse = await fetch(`/api/products`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ ids: recentlyViewed })
                        });
                        const recentData = await recentResponse.json();
                        if (recentData.success) {
                            document.getElementById('recently-viewed').innerHTML = recentData.products.map(product => `
                                <div class="product">
                                    <img src="${product.images[0] || 'logo.png'}" alt="${product.name}">
                                    <h3>${product.name}</h3>
                                    <p>₹${product.price.toFixed(2)}</p>
                                    <a href="product.html?id=${product._id}" class="btn" onclick="addToRecentlyViewed('${product._id}')">View</a>
                                </div>
                            `).join('');
                        }
                    } else {
                        document.getElementById('recently-viewed').innerHTML = '<p>No recently viewed items.</p>';
                    }
                }
            } catch (error) {
                console.error('Error loading product rows:', error);
                document.getElementById('row1-products').innerHTML = '<p>Error loading Featured Oversized.</p>';
                document.getElementById('row2-products').innerHTML = '<p>Error loading New Arrivals.</p>';
                document.getElementById('recently-viewed').innerHTML = '<p>Error loading recently viewed items.</p>';
            }
        }

        function addToRecentlyViewed(productId) {
            let recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
            if (!recentlyViewed.includes(productId)) {
                recentlyViewed.unshift(productId);
                recentlyViewed = recentlyViewed.slice(0, 10);
                localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
            }
        }

        async function searchProducts() {
            const searchTerm = document.getElementById('search').value.toLowerCase();
            if (searchTerm.length < 3) {
                loadProductRows();
                return;
            }
            try {
                const response = await fetch(`/api/products/search?query=${searchTerm}`);
                const data = await response.json();
                if (data.success) {
                    document.getElementById('row1-products').innerHTML = data.products.slice(0, 4).map(product => `
                        <div class="product">
                            <img src="${product.images[0] || 'logo.png'}" alt="${product.name}">
                            <h3>${product.name}</h3>
                            <p>₹${product.price.toFixed(2)}</p>
                            <a href="product.html?id=${product._id}" class="btn" onclick="addToRecentlyViewed('${product._id}')">View</a>
                            <button class="btn" onclick="addToCart('${product._id}')">Add to Cart</button>
                        </div>
                    `).join('');
                    document.getElementById('row2-products').innerHTML = '';
                    document.getElementById('recently-viewed').innerHTML = '';
                    document.querySelector('.hero h1').textContent = `Search Results for "${searchTerm}"`;
                } else {
                    document.getElementById('row1-products').innerHTML = '<p>No products found</p>';
                }
            } catch (error) {
                console.error('Error searching products:', error);
                document.getElementById('row1-products').innerHTML = '<p>Error searching products. Please try again.</p>';
            }
        }

        // Mobile search functionality
        document.getElementById('mobile-search').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                searchProducts();
            }
        });

        loadProductRows();
    </script>
</body>
</html>
