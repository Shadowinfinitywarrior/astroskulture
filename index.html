<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astros Kulture</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <img src="logo.png" alt="Astros Kulture">
        </div>
        <div class="menu-toggle">â˜°</div>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li class="dropdown-parent">
                <a href="#">Products</a>
                <ul class="dropdown">
                    <li><a href="shop.html?category=oversized">Oversized T-shirts</a></li>
                    <li><a href="shop.html?category=normal">Normal T-shirts</a></li>
                </ul>
            </li>
            <li class="dropdown-parent">
                <a href="#">Account</a>
                <ul class="dropdown" id="account-menu">
                    <li><a href="login.html" class="login-link">Login</a></li>
                    <li><a href="register.html" class="login-link">Register</a></li>
                    <li><a href="account.html" class="dashboard-link">Dashboard</a></li>
                </ul>
            </li>
            <li><a href="cart.html">Cart</a></li>
            <li><input type="text" placeholder="Search" id="search" onkeyup="searchProducts()"></li>
        </ul>
    </nav>

    <section class="hero fade-in">
        <h1>Welcome to Astros Kulture</h1>
        <p>Explore our exclusive collection of T-shirts as of 01:21 AM IST, Thursday, October 16, 2025!</p>
        <a href="shop.html" class="btn">Shop Now</a>
    </section>

    <section class="product-row">
        <h2 id="row1-title">Featured Oversized</h2>
        <div id="row1-products" class="products-grid"></div>
        <a href="category.html?row=row1" class="view-all">View All</a>
    </section>

    <section class="product-row">
        <h2 id="row2-title">New Arrivals</h2>
        <div id="row2-products" class="products-grid"></div>
        <a href="category.html?row=row2" class="view-all">View All</a>
    </section>

    <section class="product-row">
        <h2>Recently Viewed</h2>
        <div id="recently-viewed" class="products-grid"></div>
    </section>

    <footer>
        <p>&copy; 2025 Astros Kulture. Contact: info@astroskulture.com</p>
        <div class="footer-links">
            <a href="#">Terms</a>
            <a href="#">Privacy</a>
            <a href="#">Return Policy</a>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        updateAccountMenu();
        async function loadProductRows() {
            try {
                const response = await fetch('http://localhost:3000/api/home');
                const data = await response.json();
                if (data.success) {
                    document.getElementById('row1-title').textContent = data.row1.title;
                    document.getElementById('row1-products').innerHTML = data.row1.products.map(product => `
                        <div class="product">
                            <img src="${product.images[0] || 'logo.png'}" alt="${product.name}">
                            <h3>${product.name}</h3>
                            <p>$${product.price.toFixed(2)}</p>
                            <a href="product.html?id=${product._id}" class="btn" onclick="addToRecentlyViewed('${product._id}')">View</a>
                            <button class="btn" onclick="addToCart('${product._id}')">Add to Cart</button>
                        </div>
                    `).join('');

                    document.getElementById('row2-title').textContent = data.row2.title;
                    document.getElementById('row2-products').innerHTML = data.row2.products.map(product => `
                        <div class="product">
                            <img src="${product.images[0] || 'logo.png'}" alt="${product.name}">
                            <h3>${product.name}</h3>
                            <p>$${product.price.toFixed(2)}</p>
                            <a href="product.html?id=${product._id}" class="btn" onclick="addToRecentlyViewed('${product._id}')">View</a>
                            <button class="btn" onclick="addToCart('${product._id}')">Add to Cart</button>
                        </div>
                    `).join('');

                    const recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]').slice(0, 4);
                    if (recentlyViewed.length) {
                        const recentResponse = await fetch(`http://localhost:3000/api/products`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ ids: recentlyViewed })
                        });
                        const recentData = await recentResponse.json();
                        if (recentData.success) {
                            document.getElementById('recently-viewed').innerHTML = recentData.products.map(product => `
                                <div class="product">
                                    <img src="${product.images[0] || 'logo.png'}" alt="${product.name}">
                                    <h3>${product.name}</h3>
                                    <p>$${product.price.toFixed(2)}</p>
                                    <a href="product.html?id=${product._id}" class="btn" onclick="addToRecentlyViewed('${product._id}')">View</a>
                                </div>
                            `).join('');
                        }
                    } else {
                        document.getElementById('recently-viewed').innerHTML = '<p>No recently viewed items.</p>';
                    }
                }
            } catch (error) {
                console.error('Error loading product rows:', error);
                document.getElementById('row1-products').innerHTML = '<p>Error loading Featured Oversized.</p>';
                document.getElementById('row2-products').innerHTML = '<p>Error loading New Arrivals.</p>';
                document.getElementById('recently-viewed').innerHTML = '<p>Error loading recently viewed items.</p>';
            }
        }

        function addToRecentlyViewed(productId) {
            let recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
            if (!recentlyViewed.includes(productId)) {
                recentlyViewed.unshift(productId);
                recentlyViewed = recentlyViewed.slice(0, 10); // Limit to 10 items
                localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
            }
        }

        async function searchProducts() {
            const searchTerm = document.getElementById('search').value.toLowerCase();
            if (searchTerm.length < 3) {
                loadProductRows();
                return;
            }
            try {
                const response = await fetch(`http://localhost:3000/api/products/search?query=${searchTerm}`);
                const data = await response.json();
                if (data.success) {
                    document.getElementById('row1-products').innerHTML = data.products.slice(0, 4).map(product => `
                        <div class="product">
                            <img src="${product.images[0] || 'logo.png'}" alt="${product.name}">
                            <h3>${product.name}</h3>
                            <p>$${product.price.toFixed(2)}</p>
                            <a href="product.html?id=${product._id}" class="btn" onclick="addToRecentlyViewed('${product._id}')">View</a>
                            <button class="btn" onclick="addToCart('${product._id}')">Add to Cart</button>
                        </div>
                    `).join('');
                    document.getElementById('row2-products').innerHTML = '';
                    document.getElementById('recently-viewed').innerHTML = '';
                    document.querySelector('.hero h1').textContent = `Search Results for "${searchTerm}"`;
                } else {
                    document.getElementById('row1-products').innerHTML = '<p>No products found</p>';
                }
            } catch (error) {
                console.error('Error searching products:', error);
                document.getElementById('row1-products').innerHTML = '<p>Error searching products. Please try again.</p>';
            }
        }

        loadProductRows();
    </script>
</body>
</html>